# å¸å®‰æ¸…ç®—æ•°æ®ç›‘æ§ç³»ç»Ÿ - è¯¦ç»†å®è®­é¡¹ç›®æŒ‡å¯¼ä¹¦

## ğŸ“š é¡¹ç›®æ¦‚è¿°

### ä»€ä¹ˆæ˜¯è¿™ä¸ªé¡¹ç›®ï¼Ÿ
è¿™æ˜¯ä¸€ä¸ª**å®æ—¶ç›‘æ§å¸å®‰æœŸè´§å¸‚åœºæ¸…ç®—è®¢å•**çš„Webåº”ç”¨ç³»ç»Ÿã€‚å½“äº¤æ˜“è€…çš„ä¿è¯é‡‘ä¸è¶³æ—¶ï¼Œç³»ç»Ÿä¼šå¼ºåˆ¶å¹³ä»“ï¼ˆæ¸…ç®—ï¼‰ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå°±æ˜¯ç”¨æ¥ç›‘æ§å’Œåˆ†æè¿™äº›æ¸…ç®—æ•°æ®çš„ã€‚

### é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½
- ğŸ”„ **å®æ—¶æ•°æ®æ¥æ”¶**ï¼šé€šè¿‡WebSocketè¿æ¥å¸å®‰APIè·å–æ¸…ç®—æ•°æ®
- ğŸ’¾ **æ•°æ®å­˜å‚¨ç®¡ç†**ï¼šä½¿ç”¨Redisç¼“å­˜15åˆ†é’Ÿå†…çš„æ¸…ç®—æ•°æ®
- ğŸ“Š **ç»Ÿè®¡åˆ†æ**ï¼šè®¡ç®—å¤šç©ºæ¯”ä¾‹ã€æ€»ä»·å€¼ã€æœ€å¤§æ¸…ç®—ç­‰æŒ‡æ ‡
- ğŸ¨ **å¯è§†åŒ–å±•ç¤º**ï¼šä½¿ç”¨D3.jsåˆ›å»ºåŠ¨æ€å›¾è¡¨å’Œçƒ­åŠ›å›¾
- ğŸ” **æ•°æ®ç­›é€‰**ï¼šæ”¯æŒæŒ‰äº¤æ˜“å¯¹è¿‡æ»¤å’Œæœç´¢åŠŸèƒ½

### ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªé¡¹ç›®ï¼Ÿ
- ğŸ¯ **å­¦ä¹ ç›®æ ‡**ï¼šæŒæ¡Spring Bootã€WebSocketã€Redisç­‰ä¸»æµæŠ€æœ¯
- ğŸ’¼ **å®ç”¨ä»·å€¼**ï¼šäº†è§£é‡‘èæ•°æ®å¤„ç†å’Œå®æ—¶ç³»ç»Ÿå¼€å‘
- ğŸš€ **æŠ€èƒ½æå‡**ï¼šåŸ¹å…»å…¨æ ˆå¼€å‘èƒ½åŠ›å’Œç³»ç»Ÿè®¾è®¡æ€ç»´
- ğŸ“ˆ **ä¸šåŠ¡ç†è§£**ï¼šæ·±å…¥äº†è§£é‡‘èå¸‚åœºæ¸…ç®—æœºåˆ¶

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¯¦è§£

### åç«¯æŠ€æœ¯
| æŠ€æœ¯ | ä½œç”¨ | ä¸ºä»€ä¹ˆé€‰æ‹© |
|------|------|------------|
| **Spring Boot 3.2.3** | ä¸»æ¡†æ¶ | ç®€åŒ–é…ç½®ï¼Œå¿«é€Ÿå¼€å‘ |
| **Spring WebSocket** | å®æ—¶é€šä¿¡ | å®ç°å‰åç«¯å®æ—¶æ•°æ®ä¼ è¾“ |
| **Spring Data Redis** | æ•°æ®ç¼“å­˜ | é«˜æ€§èƒ½æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢ |
| **Thymeleaf** | æ¨¡æ¿å¼•æ“ | åŠ¨æ€ç”ŸæˆHTMLé¡µé¢ |
| **Lombok** | ä»£ç ç®€åŒ– | å‡å°‘æ ·æ¿ä»£ç  |

### å‰ç«¯æŠ€æœ¯
| æŠ€æœ¯ | ä½œç”¨ | ç‰¹ç‚¹ |
|------|------|------|
| **HTML5/CSS3** | é¡µé¢ç»“æ„å’Œæ ·å¼ | å“åº”å¼è®¾è®¡ |
| **JavaScript** | äº¤äº’é€»è¾‘ | åŸç”ŸJSï¼Œæ— æ¡†æ¶ä¾èµ– |
| **D3.js** | æ•°æ®å¯è§†åŒ– | å¼ºå¤§çš„å›¾è¡¨åº“ |
| **WebSocket API** | å®æ—¶é€šä¿¡ | æµè§ˆå™¨åŸç”Ÿæ”¯æŒ |

## ğŸ“ é¡¹ç›®ç»“æ„è§£æ

```
binance-spring/
â”œâ”€â”€ src/main/java/com/example/binance/
â”‚   â”œâ”€â”€ BinanceApplication.java          # ğŸš€ å¯åŠ¨ç±»
â”‚   â”œâ”€â”€ config/                          # âš™ï¸ é…ç½®ç±»
â”‚   â”‚   â”œâ”€â”€ RedisConfig.java            # Redisé…ç½®
â”‚   â”‚   â”œâ”€â”€ RedisDataInitializer.java   # æ•°æ®åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ WebSocketConfig.java        # WebSocketé…ç½®
â”‚   â”‚   â””â”€â”€ WebSocketInitializer.java   # WebSocketåˆå§‹åŒ–
â”‚   â”œâ”€â”€ controller/                      # ğŸ® æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ HomeController.java         # é¦–é¡µæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ LiquidationController.java  # æ¸…ç®—æ•°æ®API
â”‚   â”‚   â”œâ”€â”€ PageController.java         # é¡µé¢è·¯ç”±
â”‚   â”‚   â””â”€â”€ WebSocketController.java    # WebSocketæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ model/                          # ğŸ“Š æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ LiquidationData.java        # æ¸…ç®—æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ LiquidationOrder.java       # æ¸…ç®—è®¢å•æ¨¡å‹
â”‚   â”‚   â””â”€â”€ LiquidationStats.java       # ç»Ÿè®¡æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ service/                        # ğŸ”§ ä¸šåŠ¡æœåŠ¡
â”‚       â”œâ”€â”€ LiquidationService.java     # æ¸…ç®—æ•°æ®æœåŠ¡
â”‚       â”œâ”€â”€ SchedulerMonitor.java       # å®šæ—¶ä»»åŠ¡ç›‘æ§
â”‚       â””â”€â”€ WebSocketService.java       # WebSocketæœåŠ¡
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.properties          # ğŸ“ é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ templates/                      # ğŸ¨ å‰ç«¯é¡µé¢
â”‚       â”œâ”€â”€ index.html                  # å®æ—¶æ•°æ®é¡µé¢
â”‚       â”œâ”€â”€ 15min.html                  # 15åˆ†é’Ÿç»Ÿè®¡é¡µé¢
â”‚       â””â”€â”€ market.html                 # å¸‚åœºæ•°æ®é¡µé¢
â””â”€â”€ pom.xml                             # ğŸ“¦ Mavenä¾èµ–é…ç½®
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è¯¦è§£

### 1. æ•°æ®æ¨¡å‹å±‚ (Model)

#### 1.1 LiquidationOrder.java - æ¸…ç®—è®¢å•æ¨¡å‹
**åŠŸèƒ½æè¿°**ï¼šå®šä¹‰æ¸…ç®—è®¢å•çš„æ•°æ®ç»“æ„

**æ ¸å¿ƒå­—æ®µ**ï¼š
```java
public class LiquidationOrder {
    @JsonProperty("s") private String s;        // äº¤æ˜“å¯¹ï¼ˆå¦‚BTCUSDTï¼‰
    @JsonProperty("S") private String side;     // è®¢å•æ–¹å‘ï¼ˆBUY/SELLï¼‰
    @JsonProperty("p") private String p;        // æ¸…ç®—ä»·æ ¼
    @JsonProperty("q") private String q;        // æ¸…ç®—æ•°é‡
    @JsonProperty("T") private Long T;          // æ—¶é—´æˆ³
    @JsonProperty("ap") private String ap;      // å¹³å‡ä»·æ ¼
    private Double value;                        // è®¡ç®—å¾—åˆ°çš„ä»·å€¼
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- ä½¿ç”¨Jacksonæ³¨è§£æ˜ å°„å¸å®‰APIè¿”å›çš„JSONå­—æ®µ
- ä½¿ç”¨Lombokçš„@Dataæ³¨è§£è‡ªåŠ¨ç”Ÿæˆgetter/setter
- valueå­—æ®µç”¨äºå­˜å‚¨è®¡ç®—åçš„æ¸…ç®—ä»·å€¼ï¼ˆä»·æ ¼Ã—æ•°é‡ï¼‰

#### 1.2 LiquidationData.java - æ¸…ç®—æ•°æ®å®¹å™¨
**åŠŸèƒ½æè¿°**ï¼šåŒ…è£…æ¸…ç®—è®¢å•åˆ—è¡¨çš„å®¹å™¨ç±»

```java
public class LiquidationData {
    private List<LiquidationOrder> orders = new ArrayList<>();
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- ç®€å•çš„åŒ…è£…ç±»ï¼Œç”¨äºRediså­˜å‚¨æ—¶çš„æ•°æ®ç»“æ„
- åˆå§‹åŒ–ä¸ºç©ºåˆ—è¡¨ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸

#### 1.3 LiquidationStats.java - ç»Ÿè®¡æ•°æ®æ¨¡å‹
**åŠŸèƒ½æè¿°**ï¼šå­˜å‚¨15åˆ†é’Ÿå†…æ¸…ç®—æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯

```java
public class LiquidationStats {
    private List<LiquidationOrder> orders;    // è®¢å•åˆ—è¡¨
    private int longCount;                    // å¤šå•æ•°é‡ï¼ˆSELLæ–¹å‘ï¼‰
    private int shortCount;                   // ç©ºå•æ•°é‡ï¼ˆBUYæ–¹å‘ï¼‰
    private double totalValue;                // æ€»ä»·å€¼
    private double lastPrice;                 // æœ€æ–°ä»·æ ¼
    private double avgPrice;                  // å¹³å‡ä»·æ ¼
    private double amplitude;                 // æŒ¯å¹…ç™¾åˆ†æ¯”
    private double maxValue;                  // æœ€å¤§å•ç¬”ä»·å€¼
    private String maxValueSide;              // æœ€å¤§å•ç¬”æ–¹å‘
    private long lastUpdateTime;              // æœ€åæ›´æ–°æ—¶é—´
}
```

### 2. é…ç½®å±‚ (Config)

#### 2.1 RedisConfig.java - Redisé…ç½®ç±»
**åŠŸèƒ½æè¿°**ï¼šé…ç½®Redisè¿æ¥å’Œåºåˆ—åŒ–å™¨

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```java
@Bean
public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory connectionFactory) {
    RedisTemplate<String, Object> template = new RedisTemplate<>();
    template.setConnectionFactory(connectionFactory);
    
    // é…ç½®åºåˆ—åŒ–å™¨
    Jackson2JsonRedisSerializer<Object> jackson2JsonRedisSerializer = 
        new Jackson2JsonRedisSerializer<>(Object.class);
    
    template.setKeySerializer(new StringRedisSerializer());           // Keyä½¿ç”¨Stringåºåˆ—åŒ–
    template.setValueSerializer(jackson2JsonRedisSerializer);         // Valueä½¿ç”¨JSONåºåˆ—åŒ–
    template.setHashKeySerializer(new StringRedisSerializer());
    template.setHashValueSerializer(jackson2JsonRedisSerializer);
    
    return template;
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- ä½¿ç”¨Jackson2JsonRedisSerializerå®ç°å¯¹è±¡çš„JSONåºåˆ—åŒ–
- Keyä½¿ç”¨Stringåºåˆ—åŒ–ï¼Œä¾¿äºRediså®¢æˆ·ç«¯æŸ¥çœ‹
- æ”¯æŒHashæ•°æ®ç»“æ„çš„åºåˆ—åŒ–é…ç½®

#### 2.2 WebSocketConfig.java - WebSocketé…ç½®ç±»
**åŠŸèƒ½æè¿°**ï¼šé…ç½®WebSocketæœåŠ¡ç«¯ç‚¹

```java
@Configuration
@ConditionalOnProperty(name = "spring.websocket.enabled", havingValue = "true", matchIfMissing = false)
public class WebSocketConfig {
    @Bean
    public ServerEndpointExporter serverEndpointExporter() {
        return new ServerEndpointExporter();
    }
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- ä½¿ç”¨æ¡ä»¶æ³¨è§£ï¼Œåªæœ‰åœ¨é…ç½®å¯ç”¨æ—¶æ‰åŠ è½½
- ServerEndpointExporterç”¨äºæ‰«æå’Œæ³¨å†ŒWebSocketç«¯ç‚¹

#### 2.3 RedisDataInitializer.java - æ•°æ®åˆå§‹åŒ–å™¨
**åŠŸèƒ½æè¿°**ï¼šåº”ç”¨å¯åŠ¨æ—¶æ¸…ç†Redisä¸­çš„å†å²æ•°æ®

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```java
@Override
public void run(String... args) {
    log.info("åº”ç”¨å¯åŠ¨æ—¶æ¸…é™¤Redisæ•°æ®...");
    try {
        // æ¸…é™¤liquidation:*ç›¸å…³çš„æ•°æ®
        redisTemplate.keys("liquidation:*").forEach(key -> {
            redisTemplate.delete(key);
        });
        
        // æ¸…é™¤active_symbolsæ•°æ®
        if (redisTemplate.hasKey("active_symbols")) {
            redisTemplate.delete("active_symbols");
        }
    } catch (Exception e) {
        log.error("æ¸…é™¤Redisæ•°æ®æ—¶å‡ºé”™:", e);
    }
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- å®ç°CommandLineRunneræ¥å£ï¼Œåœ¨åº”ç”¨å¯åŠ¨åæ‰§è¡Œ
- @Order(1)ç¡®ä¿åœ¨å…¶ä»–åˆå§‹åŒ–å™¨ä¹‹å‰è¿è¡Œ
- æ¸…ç†ç­–ç•¥ï¼šåˆ é™¤æ‰€æœ‰liquidation:*é”®å’Œactive_symbolsé”®

### 3. æ§åˆ¶å™¨å±‚ (Controller)

#### 3.1 LiquidationController.java - æ¸…ç®—æ•°æ®APIæ§åˆ¶å™¨
**åŠŸèƒ½æè¿°**ï¼šæä¾›RESTful APIæ¥å£è®¿é—®æ¸…ç®—æ•°æ®

**æ ¸å¿ƒæ¥å£**ï¼š

##### 3.1.1 è·å–æ´»è·ƒäº¤æ˜“å¯¹
```java
@GetMapping("/symbols")
public ResponseEntity<List<String>> getActiveSymbols() {
    List<String> symbols = liquidationService.getActiveSymbols();
    return ResponseEntity.ok(symbols);
}
```
- **åŠŸèƒ½**ï¼šè¿”å›å½“å‰æœ‰æ¸…ç®—æ•°æ®çš„æ‰€æœ‰äº¤æ˜“å¯¹åˆ—è¡¨
- **è¿”å›**ï¼šäº¤æ˜“å¯¹å­—ç¬¦ä¸²åˆ—è¡¨ï¼ˆå¦‚["BTCUSDT", "ETHUSDT"]ï¼‰

##### 3.1.2 è·å–ç‰¹å®šäº¤æ˜“å¯¹æ•°æ®
```java
@GetMapping("/liquidation/{symbol}")
public ResponseEntity<?> getLiquidationData(@PathVariable String symbol) {
    LiquidationStats stats = liquidationService.getLiquidationStats(symbol);
    if (stats.getOrders() == null || stats.getOrders().isEmpty()) {
        return ResponseEntity.notFound().build();
    }
    return ResponseEntity.ok(stats);
}
```
- **åŠŸèƒ½**ï¼šè·å–æŒ‡å®šäº¤æ˜“å¯¹çš„15åˆ†é’Ÿç»Ÿè®¡æ•°æ®
- **å‚æ•°**ï¼šsymbol - äº¤æ˜“å¯¹åç§°
- **è¿”å›**ï¼šLiquidationStatså¯¹è±¡æˆ–404çŠ¶æ€

##### 3.1.3 è·å–æ‰€æœ‰äº¤æ˜“å¯¹æ•°æ®
```java
@GetMapping("/liquidation")
public ResponseEntity<Map<String, LiquidationStats>> getAllLiquidationData() {
    Map<String, LiquidationStats> result = liquidationService.getAllLiquidationStats();
    return ResponseEntity.ok(result);
}
```
- **åŠŸèƒ½**ï¼šè·å–æ‰€æœ‰æ´»è·ƒäº¤æ˜“å¯¹çš„ç»Ÿè®¡æ•°æ®
- **è¿”å›**ï¼šMap<äº¤æ˜“å¯¹, ç»Ÿè®¡æ•°æ®>

#### 3.2 PageController.java - é¡µé¢è·¯ç”±æ§åˆ¶å™¨
**åŠŸèƒ½æè¿°**ï¼šå¤„ç†å‰ç«¯é¡µé¢çš„è·¯ç”±è¯·æ±‚

```java
@GetMapping("/")
public String index() {
    return "index";  // è¿”å›templates/index.html
}

@GetMapping("/15min")
public String fifteenMinStats() {
    return "15min";  // è¿”å›templates/15min.html
}
```

#### 3.3 WebSocketController.java - WebSocketæ¶ˆæ¯å¤„ç†æ§åˆ¶å™¨
**åŠŸèƒ½æè¿°**ï¼šå¤„ç†é€šè¿‡HTTP POSTå‘é€çš„æ¸…ç®—æ•°æ®

```java
@PostMapping("/liquidation")
public ResponseEntity<String> processLiquidationData(@RequestBody Map<String, Object> data) {
    try {
        liquidationService.processLiquidationData(data);
        return ResponseEntity.ok("{\"status\":\"success\"}");
    } catch (Exception e) {
        return ResponseEntity.badRequest().body("{\"status\":\"error\",\"message\":\"" + e.getMessage() + "\"}");
    }
}
```
- **åŠŸèƒ½**ï¼šæ¥æ”¶å‰ç«¯å‘é€çš„æ¸…ç®—æ•°æ®å¹¶å¤„ç†
- **ç”¨é€”**ï¼šä½œä¸ºWebSocketçš„å¤‡ç”¨æ•°æ®æ¥æ”¶æ–¹å¼

### 4. æœåŠ¡å±‚ (Service) - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

#### 4.1 LiquidationService.java - æ¸…ç®—æ•°æ®æœåŠ¡
**åŠŸèƒ½æè¿°**ï¼šç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å¤„ç†ç±»

##### 4.1.1 æ•°æ®å¤„ç†æ–¹æ³•
```java
public void processLiquidationData(Map<String, Object> data) {
    if (!data.containsKey("o")) return;

    try {
        // 1. è§£ææ¸…ç®—è®¢å•æ•°æ®
        Map<String, Object> orderMap = (Map<String, Object>) data.get("o");
        LiquidationOrder order = objectMapper.convertValue(orderMap, LiquidationOrder.class);
        String symbol = order.getS();
        
        // 2. è®¡ç®—æ¸…ç®—ä»·å€¼
        double value = Double.parseDouble(order.getP()) * Double.parseDouble(order.getQ());
        order.setValue(value);

        // 3. æ—¶é—´çª—å£å¤„ç†
        long currentTime = System.currentTimeMillis();
        long fifteenMinutesAgo = currentTime - 15 * 60 * 1000;
        
        // 4. ä»Redisè·å–ç°æœ‰æ•°æ®
        LiquidationData liquidationData = new LiquidationData();
        Object existingData = redisTemplate.opsForValue().get("liquidation:" + symbol);
        
        if (existingData != null) {
            liquidationData = objectMapper.convertValue(existingData, LiquidationData.class);
        }

        // 5. æ·»åŠ æ–°è®¢å•å¹¶è¿‡æ»¤è¿‡æœŸæ•°æ®
        liquidationData.getOrders().add(order);
        List<LiquidationOrder> filteredOrders = liquidationData.getOrders().stream()
                .filter(o -> o.getT() > fifteenMinutesAgo)
                .collect(Collectors.toList());
        liquidationData.setOrders(filteredOrders);

        // 6. å­˜å‚¨å›Redis
        redisTemplate.opsForValue().set("liquidation:" + symbol, liquidationData);

        // 7. æ›´æ–°æ´»è·ƒäº¤æ˜“å¯¹åˆ—è¡¨
        updateActiveSymbols(symbol);

    } catch (Exception e) {
        log.error("å¤„ç†æ¸…ç®—æ•°æ®æ—¶å‡ºé”™:", e);
    }
}
```

**å¤„ç†æµç¨‹**ï¼š
1. **æ•°æ®éªŒè¯**ï¼šæ£€æŸ¥æ˜¯å¦åŒ…å«æ¸…ç®—è®¢å•æ•°æ®
2. **æ•°æ®è§£æ**ï¼šå°†Mapè½¬æ¢ä¸ºLiquidationOrderå¯¹è±¡
3. **ä»·å€¼è®¡ç®—**ï¼šè®¡ç®—æ¸…ç®—ä»·å€¼ï¼ˆä»·æ ¼Ã—æ•°é‡ï¼‰
4. **æ—¶é—´çª—å£**ï¼šå®šä¹‰15åˆ†é’Ÿçš„æ—¶é—´çª—å£
5. **æ•°æ®åˆå¹¶**ï¼šå°†æ–°è®¢å•æ·»åŠ åˆ°ç°æœ‰æ•°æ®ä¸­
6. **è¿‡æœŸæ¸…ç†**ï¼šè¿‡æ»¤æ‰15åˆ†é’Ÿå‰çš„è®¢å•
7. **æ•°æ®å­˜å‚¨**ï¼šæ›´æ–°Redisä¸­çš„æ•°æ®
8. **ç´¢å¼•ç»´æŠ¤**ï¼šæ›´æ–°æ´»è·ƒäº¤æ˜“å¯¹åˆ—è¡¨

##### 4.1.2 å®šæ—¶æ¸…ç†æ–¹æ³•
```java
@Scheduled(fixedRate = 900000)  // æ¯15åˆ†é’Ÿæ‰§è¡Œ
public void cleanupExpiredData() {
    try {
        long currentTime = System.currentTimeMillis();
        long fifteenMinutesAgo = currentTime - 15 * 60 * 1000;

        // è·å–æ‰€æœ‰æ´»è·ƒäº¤æ˜“å¯¹
        List<String> activeSymbols = getActiveSymbols();
        List<String> symbolsToRemove = new ArrayList<>();

        for (String symbol : activeSymbols) {
            // å¤„ç†æ¯ä¸ªäº¤æ˜“å¯¹çš„æ•°æ®
            Object dataObj = redisTemplate.opsForValue().get("liquidation:" + symbol);
            
            if (dataObj != null) {
                LiquidationData liquidationData = objectMapper.convertValue(dataObj, LiquidationData.class);
                
                // è¿‡æ»¤è¿‡æœŸè®¢å•
                List<LiquidationOrder> filteredOrders = liquidationData.getOrders().stream()
                        .filter(order -> order.getT() > fifteenMinutesAgo)
                        .collect(Collectors.toList());
                
                if (filteredOrders.isEmpty()) {
                    // å¦‚æœæ²¡æœ‰æœ‰æ•ˆè®¢å•ï¼Œæ ‡è®°ä¸ºåˆ é™¤
                    symbolsToRemove.add(symbol);
                    redisTemplate.delete("liquidation:" + symbol);
                } else {
                    // æ›´æ–°è¿‡æ»¤åçš„æ•°æ®
                    liquidationData.setOrders(filteredOrders);
                    redisTemplate.opsForValue().set("liquidation:" + symbol, liquidationData);
                }
            }
        }
        
        // æ›´æ–°æ´»è·ƒäº¤æ˜“å¯¹åˆ—è¡¨
        activeSymbols.removeAll(symbolsToRemove);
        redisTemplate.opsForValue().set("active_symbols", activeSymbols);
        
    } catch (Exception e) {
        log.error("æ¸…ç†è¿‡æœŸæ•°æ®æ—¶å‡ºé”™:", e);
    }
}
```

**æ¸…ç†ç­–ç•¥**ï¼š
- **æ‰§è¡Œé¢‘ç‡**ï¼šæ¯15åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
- **æ¸…ç†é€»è¾‘**ï¼šåˆ é™¤15åˆ†é’Ÿå‰çš„æ‰€æœ‰è®¢å•
- **å†…å­˜ä¼˜åŒ–**ï¼šåˆ é™¤æ²¡æœ‰æœ‰æ•ˆè®¢å•çš„äº¤æ˜“å¯¹æ•°æ®
- **ç´¢å¼•ç»´æŠ¤**ï¼šåŒæ­¥æ›´æ–°æ´»è·ƒäº¤æ˜“å¯¹åˆ—è¡¨

##### 4.1.3 ç»Ÿè®¡è®¡ç®—æ–¹æ³•
```java
public LiquidationStats getLiquidationStats(String symbol) {
    LiquidationStats stats = new LiquidationStats();
    
    try {
        Object dataObj = redisTemplate.opsForValue().get("liquidation:" + symbol);
        
        if (dataObj != null) {
            LiquidationData liquidationData = objectMapper.convertValue(dataObj, LiquidationData.class);
            List<LiquidationOrder> orders = liquidationData.getOrders();
            
            // åˆ†ç±»ç»Ÿè®¡å¤šç©ºè®¢å•
            List<LiquidationOrder> longOrders = orders.stream()
                    .filter(order -> "SELL".equals(order.getSide()))  // SELLè¡¨ç¤ºå¤šå•è¢«æ¸…ç®—
                    .collect(Collectors.toList());
            
            List<LiquidationOrder> shortOrders = orders.stream()
                    .filter(order -> "BUY".equals(order.getSide()))   // BUYè¡¨ç¤ºç©ºå•è¢«æ¸…ç®—
                    .collect(Collectors.toList());
            
            // è®¡ç®—æ€»ä»·å€¼
            double totalValue = orders.stream()
                    .mapToDouble(LiquidationOrder::getValue)
                    .sum();
            
            // æ‰¾å‡ºæœ€å¤§æ¸…ç®—è®¢å•
            LiquidationOrder maxOrder = orders.stream()
                    .max(Comparator.comparing(LiquidationOrder::getValue))
                    .orElse(new LiquidationOrder());
            
            // æ‰¾å‡ºæœ€æ–°è®¢å•
            LiquidationOrder latestOrder = orders.stream()
                    .max(Comparator.comparing(LiquidationOrder::getT))
                    .orElse(new LiquidationOrder());
            
            // è®¡ç®—å¹³å‡ä»·æ ¼
            double avgPrice = orders.stream()
                    .mapToDouble(order -> {
                        if (order.getAp() != null && !order.getAp().isEmpty()) {
                            return Double.parseDouble(order.getAp());
                        } else {
                            return Double.parseDouble(order.getP());
                        }
                    })
                    .average()
                    .orElse(0);
            
            // è®¡ç®—ä»·æ ¼æŒ¯å¹…
            double latestP = latestOrder.getT() != null ? Double.parseDouble(latestOrder.getP()) : 0;
            double amplitude = avgPrice > 0 ? ((latestP - avgPrice) / avgPrice) * 100 : 0;
            
            // è®¾ç½®ç»Ÿè®¡ç»“æœ
            stats.setOrders(orders);
            stats.setLongCount(longOrders.size());
            stats.setShortCount(shortOrders.size());
            stats.setTotalValue(totalValue);
            stats.setLastPrice(latestP);
            stats.setAvgPrice(avgPrice);
            stats.setAmplitude(amplitude);
            stats.setMaxValue(maxOrder.getValue() != null ? maxOrder.getValue() : 0);
            stats.setMaxValueSide(maxOrder.getSide());
            stats.setLastUpdateTime(latestOrder.getT() != null ? latestOrder.getT() : 0);
        }
    } catch (Exception e) {
        log.error("è·å–æ¸…ç®—ç»Ÿè®¡æ•°æ®æ—¶å‡ºé”™:", e);
    }
    
    return stats;
}
```

**ç»Ÿè®¡æŒ‡æ ‡è¯´æ˜**ï¼š
- **å¤šç©ºåˆ†ç±»**ï¼šSELLè®¢å•è¡¨ç¤ºå¤šå•æ¸…ç®—ï¼ŒBUYè®¢å•è¡¨ç¤ºç©ºå•æ¸…ç®—
- **æ€»ä»·å€¼**ï¼šæ‰€æœ‰æ¸…ç®—è®¢å•çš„ä»·å€¼æ€»å’Œ
- **æœ€å¤§è®¢å•**ï¼šå•ç¬”ä»·å€¼æœ€å¤§çš„æ¸…ç®—è®¢å•
- **å¹³å‡ä»·æ ¼**ï¼šä¼˜å…ˆä½¿ç”¨å¹³å‡ä»·æ ¼(ap)ï¼Œå¦åˆ™ä½¿ç”¨æ¸…ç®—ä»·æ ¼(p)
- **ä»·æ ¼æŒ¯å¹…**ï¼šæœ€æ–°ä»·æ ¼ç›¸å¯¹äºå¹³å‡ä»·æ ¼çš„å˜åŒ–ç™¾åˆ†æ¯”

#### 4.2 WebSocketService.java - WebSocketé€šä¿¡æœåŠ¡
**åŠŸèƒ½æè¿°**ï¼šå¤„ç†WebSocketè¿æ¥å’Œæ¶ˆæ¯ä¼ è¾“

##### 4.2.1 æœåŠ¡ç«¯WebSocketå¤„ç†
```java
@ServerEndpoint("/ws")
public class WebSocketService {
    private static final Map<Session, WebSocketService> clients = new ConcurrentHashMap<>();
    
    @OnOpen
    public void onOpen(Session session) {
        this.session = session;
        clients.put(session, this);
        log.info("å®¢æˆ·ç«¯å·²è¿æ¥: {}", session.getId());
    }
    
    @OnClose
    public void onClose() {
        clients.remove(session);
        log.info("å®¢æˆ·ç«¯è¿æ¥å·²å…³é—­: {}", session.getId());
    }
    
    @OnMessage
    public void onMessage(String message, Session session) {
        try {
            Map<String, Object> data = objectMapper.readValue(message, Map.class);
            if (data.containsKey("o")) {
                liquidationService.processLiquidationData(data);
            }
        } catch (Exception e) {
            log.error("å¤„ç†å®¢æˆ·ç«¯æ¶ˆæ¯æ—¶å‡ºé”™:", e);
        }
    }
    
    @OnError
    public void onError(Session session, Throwable error) {
        log.error("WebSocketé”™è¯¯:", error);
    }
}
```

**è¿æ¥ç®¡ç†**ï¼š
- ä½¿ç”¨ConcurrentHashMapç®¡ç†å®¢æˆ·ç«¯è¿æ¥
- æ”¯æŒå¤šå®¢æˆ·ç«¯åŒæ—¶è¿æ¥
- è‡ªåŠ¨å¤„ç†è¿æ¥çš„å»ºç«‹å’Œæ–­å¼€

##### 4.2.2 å¸å®‰WebSocketå®¢æˆ·ç«¯
```java
public void initBinanceWebSocket() {
    try {
        WebSocketContainer container = ContainerProvider.getWebSocketContainer();
        String uri = "wss://fstream.binance.com/ws/!forceOrder@arr";
        
        binanceSession = container.connectToServer(new Endpoint() {
            @Override
            public void onOpen(Session session, EndpointConfig config) {
                log.info("å·²è¿æ¥åˆ°å¸å®‰WebSocket API");
                
                session.addMessageHandler(new MessageHandler.Whole<String>() {
                    @Override
                    public void onMessage(String message) {
                        try {
                            Map<String, Object> data = objectMapper.readValue(message, Map.class);
                            if (data.containsKey("o")) {
                                liquidationService.processLiquidationData(data);
                            }
                        } catch (Exception e) {
                            log.error("å¤„ç†WebSocketæ¶ˆæ¯æ—¶å‡ºé”™:", e);
                        }
                    }
                });
            }
        }, ClientEndpointConfig.Builder.create().build(), URI.create(uri));
        
    } catch (Exception e) {
        log.error("åˆå§‹åŒ–å¸å®‰WebSocketè¿æ¥æ—¶å‡ºé”™:", e);
    }
}
```

**è¿æ¥ç‰¹ç‚¹**ï¼š
- **æ•°æ®æº**ï¼šå¸å®‰æœŸè´§å¼ºåˆ¶æ¸…ç®—æ•°æ®æµ
- **åè®®**ï¼šWSSå®‰å…¨WebSocketè¿æ¥
- **æ•°æ®æ ¼å¼**ï¼šJSONæ ¼å¼çš„æ¸…ç®—è®¢å•æ•°æ®
- **å¤„ç†æ–¹å¼**ï¼šå®æ—¶æ¥æ”¶å¹¶è½¬å‘ç»™ä¸šåŠ¡æœåŠ¡å¤„ç†

#### 4.3 SchedulerMonitor.java - å®šæ—¶ä»»åŠ¡ç›‘æ§
**åŠŸèƒ½æè¿°**ï¼šç›‘æ§å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µ

```java
@Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ‰§è¡Œ
public void logCurrentTime() {
    log.info("å®šæ—¶ä»»åŠ¡ç›‘æ§ - å½“å‰æ—¶é—´: {}", LocalDateTime.now().format(formatter));
}

@Scheduled(fixedRate = 900000)  // æ¯15åˆ†é’Ÿæ‰§è¡Œ
public void logFifteenMinuteTask() {
    log.info("15åˆ†é’Ÿå®šæ—¶ä»»åŠ¡ç›‘æ§ - æ‰§è¡Œæ—¶é—´: {}", LocalDateTime.now().format(formatter));
}
```

**ç›‘æ§ç›®çš„**ï¼š
- éªŒè¯å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨æ­£å¸¸å·¥ä½œ
- ç¡®è®¤15åˆ†é’Ÿæ¸…ç†ä»»åŠ¡æŒ‰æ—¶æ‰§è¡Œ
- æä¾›ç³»ç»Ÿè¿è¡ŒçŠ¶æ€çš„å¯è§æ€§

### 5. å‰ç«¯é¡µé¢åˆ†æ

#### 5.1 å®æ—¶æ•°æ®é¡µé¢ (index.html)
**åŠŸèƒ½æè¿°**ï¼šå®æ—¶æ˜¾ç¤ºæ¸…ç®—è®¢å•æ•°æ®

**ä¸»è¦ç‰¹æ€§**ï¼š
- âš¡ WebSocketå®æ—¶è¿æ¥
- ğŸ“Š åŠ¨æ€æ•°æ®è¡¨æ ¼
- ğŸ¨ D3.jsçƒ­åŠ›å›¾
- ğŸ” äº¤æ˜“å¯¹ç­›é€‰
- ğŸ“± å“åº”å¼å¸ƒå±€

**æŠ€æœ¯å®ç°**ï¼š
```javascript
// WebSocketè¿æ¥
const ws = new WebSocket('ws://localhost:3000/websocket');
ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    updateTable(data);
    updateHeatmap(data);
};

// D3.jsçƒ­åŠ›å›¾
function createHeatmap(data) {
    const svg = d3.select("#heatmap")
        .append("svg")
        .attr("width", width)
        .attr("height", height);
    
    // é¢œè‰²æ¯”ä¾‹å°º
    const colorScale = d3.scaleSequential(d3.interpolateRdYlBu)
        .domain(d3.extent(data, d => d.value));
}
```

#### 5.2 ç»Ÿè®¡åˆ†æé¡µé¢ (15min.html)
**åŠŸèƒ½æè¿°**ï¼šå±•ç¤º15åˆ†é’Ÿç»Ÿè®¡æ•°æ®

**ä¸»è¦ç‰¹æ€§**ï¼š
- ğŸ“ˆ å¤šç©ºæ¯”ä¾‹å›¾è¡¨
- ğŸ’° ä»·å€¼ç»Ÿè®¡å±•ç¤º
- ğŸ† æœ€å¤§æ¸…ç®—æ’è¡Œ
- ğŸ”„ è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
- ğŸ“Š å¯è§†åŒ–å›¾è¡¨

**æ ¸å¿ƒJavaScriptå‡½æ•°è¯¦è§£**ï¼š

1. **ç»Ÿè®¡æ•°æ®è·å–**
```javascript
// è·å–15åˆ†é’Ÿç»Ÿè®¡æ•°æ®
async function fetchStatsData() {
    try {
        const response = await fetch('/api/liquidation');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        statsData = data;
        updateStatsTable();  // æ›´æ–°ç»Ÿè®¡è¡¨æ ¼
        updateHeatmap();     // æ›´æ–°çƒ­åŠ›å›¾
        updateRefreshStatus(); // æ›´æ–°åˆ·æ–°çŠ¶æ€
    } catch (error) {
        console.error('è·å–ç»Ÿè®¡æ•°æ®æ—¶å‡ºé”™:', error);
    }
}
```

2. **ç»Ÿè®¡è¡¨æ ¼æ›´æ–°**
```javascript
// æ›´æ–°ç»Ÿè®¡è¡¨æ ¼æ˜¾ç¤º
function updateStatsTable() {
    const tbody = document.getElementById('statsTable').getElementsByTagName('tbody')[0];
    tbody.innerHTML = '';
    
    // æŒ‰æ€»ä»·å€¼é™åºæ’åºäº¤æ˜“å¯¹
    const symbols = Object.keys(statsData)
        .filter(symbol => !filterValue || symbol.includes(filterValue.toUpperCase()))
        .sort((a, b) => statsData[b].totalValue - statsData[a].totalValue);
    
    symbols.forEach(symbol => {
        const stats = statsData[symbol];
        const row = tbody.insertRow();
        
        // æ ¹æ®å¤šç©ºå•æ•°é‡è®¾ç½®è¡Œæ ·å¼
        if (stats.longCount > stats.shortCount) {
            row.className = 'long';      // å¤šå•å ä¼˜
        } else if (stats.shortCount > stats.longCount) {
            row.className = 'short';     // ç©ºå•å ä¼˜
        } else {
            row.className = 'neutral';   // å¹³è¡¡
        }
        
        // å¡«å……è¡¨æ ¼æ•°æ®ï¼šäº¤æ˜“å¯¹ã€å¤šå•æ•°ã€ç©ºå•æ•°ã€æ€»ä»·å€¼ã€æœ€å¤§å•ç¬”ã€æœ€æ–°ä»·æ ¼ç­‰
        row.insertCell(0).textContent = symbol;
        row.insertCell(1).textContent = stats.longCount;
        row.insertCell(2).textContent = stats.shortCount;
        row.insertCell(3).textContent = stats.totalValue.toFixed(2);
        row.insertCell(4).textContent = stats.maxValue.toFixed(2);
        row.insertCell(5).textContent = stats.maxValueSide === 'BUY' ? 'åšç©º' : 'åšå¤š';
        row.insertCell(6).textContent = stats.lastPrice.toFixed(symbol.includes('BTC') ? 2 : 4);
        row.insertCell(7).textContent = stats.avgPrice.toFixed(symbol.includes('BTC') ? 2 : 4);
        row.insertCell(8).textContent = stats.amplitude.toFixed(2);
        row.insertCell(9).textContent = new Date(stats.lastUpdateTime).toLocaleTimeString();
        
        // æ·»åŠ ç‚¹å‡»è·³è½¬è¯¦æƒ…é¡µåŠŸèƒ½
        row.addEventListener('click', () => {
            window.location.href = `/detail/${symbol}`;
        });
        row.style.cursor = 'pointer';
    });
}
```

3. **å®šæ—¶åˆ·æ–°æœºåˆ¶**
```javascript
// é¡µé¢åˆå§‹åŒ–æ—¶è®¾ç½®å®šæ—¶åˆ·æ–°
document.addEventListener('DOMContentLoaded', function() {
    fetchStatsData();          // è·å–åˆå§‹æ•°æ®
    
    // æ¯10ç§’è‡ªåŠ¨åˆ·æ–°ç»Ÿè®¡æ•°æ®
    refreshInterval = setInterval(fetchStatsData, 10000);
    
    // äº¤æ˜“å¯¹è¿‡æ»¤å™¨äº‹ä»¶
    document.getElementById('symbolFilter').addEventListener('input', function() {
        filterValue = this.value.trim();
        updateStatsTable();
        updateHeatmap();
    });
});
```

4. **D3.jsçƒ­åŠ›å›¾å¯è§†åŒ–**
```javascript
// æ›´æ–°çƒ­ç‚¹å›¾å¯è§†åŒ–
function updateHeatmap() {
    const heatmapContainer = document.getElementById('heatmap');
    heatmapContainer.innerHTML = '';
    
    // å‡†å¤‡æ•°æ®ï¼šè¿‡æ»¤ã€æ’åºã€å–å‰20ä¸ªäº¤æ˜“å¯¹
    const data = Object.keys(statsData)
        .filter(symbol => !filterValue || symbol.includes(filterValue.toUpperCase()))
        .map(symbol => ({
            symbol,
            buyCount: statsData[symbol].buyCount,
            sellCount: statsData[symbol].sellCount,
            totalValue: statsData[symbol].totalValue,
            priceChange: statsData[symbol].priceChange || 0
        }))
        .sort((a, b) => b.totalValue - a.totalValue)
        .slice(0, 20);
    
    // åˆ›å»ºSVGç”»å¸ƒ
    const margin = {top: 20, right: 20, bottom: 60, left: 60};
    const width = Math.min(800, window.innerWidth - 100) - margin.left - margin.right;
    const height = 300 - margin.top - margin.bottom;
    
    const svg = d3.select('#heatmap')
        .append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        .append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);
    
    // åˆ›å»ºæ¯”ä¾‹å°º
    const x = d3.scaleBand()
        .range([0, width])
        .domain(data.map(d => d.symbol))
        .padding(0.05);
    
    // é¢œè‰²æ¯”ä¾‹å°ºï¼šçº¢è‰²(è·Œ) -> é»„è‰²(å¹³) -> ç»¿è‰²(æ¶¨)
    const colorScale = d3.scaleLinear()
        .domain([-2, 0, 2])
        .range(['#F44336', '#FFD700', '#4CAF50']);
    
    // é€æ˜åº¦æ¯”ä¾‹å°ºï¼šæ ¹æ®äº¤æ˜“ä»·å€¼è°ƒæ•´é€æ˜åº¦
    const sizeScale = d3.scaleLinear()
        .domain([0, d3.max(data, d => d.totalValue)])
        .range([0.3, 1]);
    
    // ç»˜åˆ¶çƒ­åŠ›å›¾çŸ©å½¢
    svg.selectAll()
        .data(data)
        .enter()
        .append('rect')
        .attr('x', d => x(d.symbol))
        .attr('y', 0)
        .attr('width', x.bandwidth())
        .attr('height', height)
        .style('fill', d => colorScale(d.priceChange))
        .style('fill-opacity', d => sizeScale(d.totalValue))
        .append('title')
        .text(d => `${d.symbol}\nä»·æ ¼å˜åŒ–: ${d.priceChange.toFixed(2)}%\nåšç©ºæ¸…ç®—: ${d.buyCount}\nåšå¤šæ¸…ç®—: ${d.sellCount}\næ€»ä»·å€¼: ${d.totalValue.toFixed(2)} USD`);
}
```

### 6. åˆå§‹åŒ–ç»„ä»¶ (Initializer)

#### 6.1 WebSocketInitializer.java - WebSocketåˆå§‹åŒ–å™¨
**åŠŸèƒ½æè¿°**ï¼šåº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–å¸å®‰WebSocketè¿æ¥

```java
@Component
@ConditionalOnProperty(name = "spring.websocket.enabled", havingValue = "true", matchIfMissing = false)
@Order(2)
public class WebSocketInitializer implements CommandLineRunner {
    
    @Autowired
    private WebSocketService webSocketService;
    
    @Override
    public void run(String... args) throws Exception {
        log.info("åˆå§‹åŒ–å¸å®‰WebSocketè¿æ¥...");
        webSocketService.initBinanceWebSocket();
    }
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- æ¡ä»¶åŠ è½½ï¼šåªæœ‰åœ¨WebSocketå¯ç”¨æ—¶æ‰æ‰§è¡Œ
- æ‰§è¡Œé¡ºåºï¼š@Order(2)ç¡®ä¿åœ¨æ•°æ®æ¸…ç†åæ‰§è¡Œ
- è‡ªåŠ¨å¯åŠ¨ï¼šå®ç°CommandLineRunneræ¥å£ï¼Œåº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ

## ğŸ“š è¯¦ç»†å­¦ä¹ è·¯å¾„

### é˜¶æ®µä¸€ï¼šåŸºç¡€ç¯å¢ƒæ­å»º (1-2å¤©)

#### 1.1 å¼€å‘ç¯å¢ƒå‡†å¤‡
**å¿…éœ€è½¯ä»¶**ï¼š
- â˜• **Java 17+**ï¼šé¡¹ç›®è¿è¡Œç¯å¢ƒ
- ğŸ”§ **Maven 3.6+**ï¼šä¾èµ–ç®¡ç†å·¥å…·
- ğŸ—„ï¸ **Redis 6.0+**ï¼šæ•°æ®ç¼“å­˜æœåŠ¡
- ğŸ’» **IDE**ï¼šIntelliJ IDEA æˆ– Eclipse

**ç¯å¢ƒéªŒè¯**ï¼š
```bash
# éªŒè¯Javaç‰ˆæœ¬
java -version

# éªŒè¯Mavenç‰ˆæœ¬
mvn -version

# å¯åŠ¨RedisæœåŠ¡
redis-server

# æµ‹è¯•Redisè¿æ¥
redis-cli ping
```

#### 1.2 é¡¹ç›®å¯¼å…¥å’Œé…ç½®
**æ­¥éª¤è¯¦è§£**ï¼š
1. **å…‹éš†é¡¹ç›®**ï¼š
   ```bash
   git clone <é¡¹ç›®åœ°å€>
   cd binance-spring
   ```

2. **å¯¼å…¥IDE**ï¼š
   - é€‰æ‹©"Import Project"
   - é€‰æ‹©é¡¹ç›®æ ¹ç›®å½•
   - é€‰æ‹©"Maven"é¡¹ç›®ç±»å‹
   - ç­‰å¾…ä¾èµ–ä¸‹è½½å®Œæˆ

3. **é…ç½®æ£€æŸ¥**ï¼š
   - æ£€æŸ¥<mcfile name="application.properties" path="src/main/resources/application.properties"></mcfile>é…ç½®
   - ç¡®è®¤Redisè¿æ¥ä¿¡æ¯æ­£ç¡®
   - éªŒè¯ç«¯å£3000æœªè¢«å ç”¨

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒæ¦‚å¿µç†è§£ (2-3å¤©)

#### 2.1 Spring Bootæ¡†æ¶å­¦ä¹ 
**é‡ç‚¹æ¦‚å¿µ**ï¼š
- **è‡ªåŠ¨é…ç½®**ï¼šç†è§£@SpringBootApplicationæ³¨è§£
- **ä¾èµ–æ³¨å…¥**ï¼šæŒæ¡@Autowiredå’Œ@Component
- **é…ç½®ç®¡ç†**ï¼šå­¦ä¹ application.propertiesçš„ä½œç”¨
- **å¯åŠ¨æµç¨‹**ï¼šäº†è§£Spring Bootåº”ç”¨çš„å¯åŠ¨è¿‡ç¨‹

**å®è·µä»»åŠ¡**ï¼š
1. åˆ†æ<mcfile name="BinanceApplication.java" path="src/main/java/com/example/binance/BinanceApplication.java"></mcfile>ä¸»å¯åŠ¨ç±»
2. ç†è§£@EnableSchedulingæ³¨è§£çš„ä½œç”¨
3. è§‚å¯Ÿåº”ç”¨å¯åŠ¨æ—¥å¿—ï¼Œç†è§£åˆå§‹åŒ–è¿‡ç¨‹

#### 2.2 Redisç¼“å­˜æŠ€æœ¯
**æ ¸å¿ƒçŸ¥è¯†ç‚¹**ï¼š
- **æ•°æ®ç»“æ„**ï¼šStringã€Listã€Hashã€Setã€ZSet
- **è¿‡æœŸç­–ç•¥**ï¼šTTLè®¾ç½®å’Œè‡ªåŠ¨è¿‡æœŸ
- **åºåˆ—åŒ–**ï¼šJavaå¯¹è±¡ä¸Redisæ•°æ®çš„è½¬æ¢
- **è¿æ¥æ± **ï¼šRedisTemplateçš„é…ç½®å’Œä½¿ç”¨

**å®è·µä»»åŠ¡**ï¼š
1. ç ”ç©¶<mcsymbol name="redisTemplate" filename="RedisConfig.java" path="src/main/java/com/example/binance/config/RedisConfig.java" startline="15" type="function"></mcsymbol>é…ç½®æ–¹æ³•
2. ç†è§£Jackson2JsonRedisSerializerçš„ä½œç”¨
3. ä½¿ç”¨Rediså®¢æˆ·ç«¯æŸ¥çœ‹å­˜å‚¨çš„æ•°æ®ç»“æ„

#### 2.3 WebSocketé€šä¿¡æœºåˆ¶
**æŠ€æœ¯è¦ç‚¹**ï¼š
- **åè®®ç‰¹ç‚¹**ï¼šå…¨åŒå·¥é€šä¿¡ã€ä½å»¶è¿Ÿ
- **ç”Ÿå‘½å‘¨æœŸ**ï¼šè¿æ¥å»ºç«‹ã€æ¶ˆæ¯ä¼ è¾“ã€è¿æ¥å…³é—­
- **æ³¨è§£ä½¿ç”¨**ï¼š@ServerEndpointã€@OnOpenã€@OnMessageç­‰
- **å®¢æˆ·ç«¯è¿æ¥**ï¼šæµè§ˆå™¨WebSocket APIä½¿ç”¨

**å®è·µä»»åŠ¡**ï¼š
1. åˆ†æ<mcsymbol name="onOpen" filename="WebSocketService.java" path="src/main/java/com/example/binance/service/WebSocketService.java" startline="35" type="function"></mcsymbol>è¿æ¥å¤„ç†
2. ç†è§£<mcsymbol name="onMessage" filename="WebSocketService.java" path="src/main/java/com/example/binance/service/WebSocketService.java" startline="42" type="function"></mcsymbol>æ¶ˆæ¯å¤„ç†é€»è¾‘
3. æµ‹è¯•å‰ç«¯WebSocketè¿æ¥åŠŸèƒ½

### é˜¶æ®µä¸‰ï¼šä¸šåŠ¡é€»è¾‘æ·±å…¥ (3-4å¤©)

#### 3.1 æ•°æ®æ¨¡å‹è®¾è®¡åˆ†æ
**å­¦ä¹ é‡ç‚¹**ï¼š
- **JSONæ˜ å°„**ï¼š@JsonPropertyæ³¨è§£çš„ä½¿ç”¨
- **æ•°æ®å°è£…**ï¼šç†è§£DTOï¼ˆData Transfer Objectï¼‰æ¨¡å¼
- **ç»Ÿè®¡æ¨¡å‹**ï¼šLiquidationStatsçš„è®¾è®¡æ€è·¯

**ä»£ç åˆ†æä»»åŠ¡**ï¼š
1. **LiquidationOrderæ¨¡å‹**ï¼š
   ```java
   // åˆ†æå­—æ®µæ˜ å°„å…³ç³»
   @JsonProperty("s") private String s;        // å¸å®‰APIå­—æ®µæ˜ å°„
   @JsonProperty("S") private String side;     // è®¢å•æ–¹å‘æ˜ å°„
   private Double value;                        // è®¡ç®—å­—æ®µ
   ```

2. **æ•°æ®è½¬æ¢è¿‡ç¨‹**ï¼š
   - å¸å®‰API JSON â†’ LiquidationOrderå¯¹è±¡
   - ä»·å€¼è®¡ç®—ï¼šprice Ã— quantity
   - Rediså­˜å‚¨ï¼šå¯¹è±¡ â†’ JSONå­—ç¬¦ä¸²

#### 3.2 æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å‰–æ
**processLiquidationDataæ–¹æ³•è¯¦è§£**ï¼š

```java
// ç¬¬ä¸€æ­¥ï¼šæ•°æ®éªŒè¯å’Œè§£æ
if (!data.containsKey("o")) return;  // éªŒè¯æ•°æ®æ ¼å¼
Map<String, Object> orderMap = (Map<String, Object>) data.get("o");
LiquidationOrder order = objectMapper.convertValue(orderMap, LiquidationOrder.class);

// ç¬¬äºŒæ­¥ï¼šä¸šåŠ¡è®¡ç®—
double value = Double.parseDouble(order.getP()) * Double.parseDouble(order.getQ());
order.setValue(value);  // è®¾ç½®è®¡ç®—åçš„ä»·å€¼

// ç¬¬ä¸‰æ­¥ï¼šæ—¶é—´çª—å£å¤„ç†
long currentTime = System.currentTimeMillis();
long fifteenMinutesAgo = currentTime - 15 * 60 * 1000;  // 15åˆ†é’Ÿå‰çš„æ—¶é—´æˆ³

// ç¬¬å››æ­¥ï¼šæ•°æ®åˆå¹¶å’Œè¿‡æ»¤
List<LiquidationOrder> filteredOrders = liquidationData.getOrders().stream()
        .filter(o -> o.getT() > fifteenMinutesAgo)  // è¿‡æ»¤15åˆ†é’Ÿå†…çš„æ•°æ®
        .collect(Collectors.toList());
```

**å­¦ä¹ è¦ç‚¹**ï¼š
- **æµå¼å¤„ç†**ï¼šJava 8 Stream APIçš„ä½¿ç”¨
- **æ—¶é—´çª—å£**ï¼šæ»‘åŠ¨çª—å£çš„å®ç°åŸç†
- **æ•°æ®è¿‡æ»¤**ï¼šlambdaè¡¨è¾¾å¼å’Œfilteræ“ä½œ
- **å¼‚å¸¸å¤„ç†**ï¼štry-catchçš„æœ€ä½³å®è·µ

#### 3.3 ç»Ÿè®¡ç®—æ³•å®ç°
**å¤šç©ºç»Ÿè®¡é€»è¾‘**ï¼š
```java
// å¤šå•ç»Ÿè®¡ï¼ˆSELLæ–¹å‘è¡¨ç¤ºå¤šå•è¢«æ¸…ç®—ï¼‰
List<LiquidationOrder> longOrders = orders.stream()
        .filter(order -> "SELL".equals(order.getSide()))
        .collect(Collectors.toList());

// ç©ºå•ç»Ÿè®¡ï¼ˆBUYæ–¹å‘è¡¨ç¤ºç©ºå•è¢«æ¸…ç®—ï¼‰
List<LiquidationOrder> shortOrders = orders.stream()
        .filter(order -> "BUY".equals(order.getSide()))
        .collect(Collectors.toList());
```

**ä»·æ ¼æŒ¯å¹…è®¡ç®—**ï¼š
```java
// è®¡ç®—ä»·æ ¼æŒ¯å¹…ç™¾åˆ†æ¯”
double latestP = Double.parseDouble(latestOrder.getP());
double amplitude = avgPrice > 0 ? ((latestP - avgPrice) / avgPrice) * 100 : 0;
```

**å­¦ä¹ é‡ç‚¹**ï¼š
- **åˆ†ç»„ç»Ÿè®¡**ï¼šæŒ‰è®¢å•æ–¹å‘åˆ†ç±»
- **èšåˆè®¡ç®—**ï¼šsumã€maxã€averageç­‰æ“ä½œ
- **ç™¾åˆ†æ¯”è®¡ç®—**ï¼šæŒ¯å¹…çš„æ•°å­¦å…¬å¼
- **è¾¹ç•Œå¤„ç†**ï¼šé¿å…é™¤é›¶é”™è¯¯

### é˜¶æ®µå››ï¼šå‰ç«¯æŠ€æœ¯å­¦ä¹  (2-3å¤©)

#### 4.1 HTML5å’ŒCSS3åŸºç¡€
**é¡µé¢ç»“æ„åˆ†æ**ï¼š
```html
<!-- å“åº”å¼å¸ƒå±€ -->
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8">  <!-- ä¸»è¦å†…å®¹åŒº -->
            <div id="liquidation-table"></div>
        </div>
        <div class="col-md-4">  <!-- ä¾§è¾¹æ  -->
            <div id="heatmap"></div>
        </div>
    </div>
</div>
```

**CSSæ ·å¼ç‰¹ç‚¹**ï¼š
- **Bootstrapæ¡†æ¶**ï¼šå“åº”å¼ç½‘æ ¼ç³»ç»Ÿ
- **è‡ªå®šä¹‰æ ·å¼**ï¼šè¡¨æ ¼ç¾åŒ–å’ŒåŠ¨ç”»æ•ˆæœ
- **é¢œè‰²æ–¹æ¡ˆ**ï¼šå¤šç©ºå•çš„è§†è§‰åŒºåˆ†

#### 4.2 JavaScriptå’ŒD3.jså¯è§†åŒ–
**WebSocketå®¢æˆ·ç«¯å®ç°**ï¼š
```javascript
// å»ºç«‹WebSocketè¿æ¥
const ws = new WebSocket('ws://localhost:3000/ws');

// è¿æ¥æˆåŠŸå¤„ç†
ws.onopen = function(event) {
    console.log('WebSocketè¿æ¥å·²å»ºç«‹');
    updateConnectionStatus('å·²è¿æ¥');
};

// æ¥æ”¶æ¶ˆæ¯å¤„ç†
ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    if (data.o) {  // æ¸…ç®—è®¢å•æ•°æ®
        addLiquidationOrder(data.o);
        updateHeatmap(data.o);
    }
};
```

**D3.jsçƒ­åŠ›å›¾å®ç°**ï¼š
```javascript
// åˆ›å»ºSVGå®¹å™¨
const svg = d3.select("#heatmap")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

// é¢œè‰²æ¯”ä¾‹å°º
const colorScale = d3.scaleSequential(d3.interpolateRdYlBu)
    .domain(d3.extent(data, d => d.value));

// ç»˜åˆ¶çƒ­åŠ›å›¾çŸ©å½¢
svg.selectAll("rect")
    .data(data)
    .enter()
    .append("rect")
    .attr("fill", d => colorScale(d.value))
    .attr("opacity", 0.8);
```

**å­¦ä¹ è¦ç‚¹**ï¼š
- **å¼‚æ­¥ç¼–ç¨‹**ï¼šPromiseå’Œasync/await
- **DOMæ“ä½œ**ï¼šåŠ¨æ€æ›´æ–°é¡µé¢å†…å®¹
- **æ•°æ®å¯è§†åŒ–**ï¼šD3.jsçš„é€‰æ‹©å™¨å’Œæ•°æ®ç»‘å®š
- **äº‹ä»¶å¤„ç†**ï¼šç”¨æˆ·äº¤äº’å’Œå®æ—¶æ›´æ–°

### é˜¶æ®µäº”ï¼šç³»ç»Ÿé›†æˆå’Œæµ‹è¯• (2-3å¤©)

#### 5.1 å®Œæ•´æµç¨‹æµ‹è¯•
**æµ‹è¯•åœºæ™¯è®¾è®¡**ï¼š
1. **å¯åŠ¨æµ‹è¯•**ï¼š
   - éªŒè¯Redisè¿æ¥
   - æ£€æŸ¥WebSocketåˆå§‹åŒ–
   - ç¡®è®¤å®šæ—¶ä»»åŠ¡å¯åŠ¨

2. **æ•°æ®æµæµ‹è¯•**ï¼š
   - æ¨¡æ‹Ÿå¸å®‰æ•°æ®æ¨é€
   - éªŒè¯æ•°æ®å­˜å‚¨åˆ°Redis
   - æ£€æŸ¥å‰ç«¯å®æ—¶æ›´æ–°

3. **APIæ¥å£æµ‹è¯•**ï¼š
   ```bash
   # æµ‹è¯•è·å–æ´»è·ƒäº¤æ˜“å¯¹
   curl http://localhost:3000/api/symbols
   
   # æµ‹è¯•è·å–ç‰¹å®šäº¤æ˜“å¯¹æ•°æ®
   curl http://localhost:3000/api/liquidation/BTCUSDT
   
   # æµ‹è¯•è·å–æ‰€æœ‰æ•°æ®
   curl http://localhost:3000/api/liquidation
   ```

#### 5.2 æ€§èƒ½ä¼˜åŒ–åˆ†æ
**å†…å­˜ä½¿ç”¨ä¼˜åŒ–**ï¼š
- **å®šæ—¶æ¸…ç†**ï¼š15åˆ†é’Ÿè¿‡æœŸæ•°æ®è‡ªåŠ¨åˆ é™¤
- **æ•°æ®ç»“æ„**ï¼šä½¿ç”¨Stream APIå‡å°‘ä¸­é—´å¯¹è±¡
- **è¿æ¥æ± **ï¼šRedisè¿æ¥å¤ç”¨

**å¹¶å‘å¤„ç†ä¼˜åŒ–**ï¼š
- **çº¿ç¨‹å®‰å…¨**ï¼šConcurrentHashMapç®¡ç†WebSocketè¿æ¥
- **å¼‚æ­¥å¤„ç†**ï¼šWebSocketæ¶ˆæ¯å¼‚æ­¥å¤„ç†
- **èµ„æºç®¡ç†**ï¼šåŠæ—¶é‡Šæ”¾æ— æ•ˆè¿æ¥

#### 5.3 é”™è¯¯å¤„ç†å’Œæ—¥å¿—
**å¼‚å¸¸å¤„ç†ç­–ç•¥**ï¼š
```java
try {
    // ä¸šåŠ¡é€»è¾‘å¤„ç†
    liquidationService.processLiquidationData(data);
} catch (JsonProcessingException e) {
    log.error("JSONè§£æé”™è¯¯:", e);
} catch (NumberFormatException e) {
    log.error("æ•°å­—æ ¼å¼é”™è¯¯:", e);
} catch (Exception e) {
    log.error("å¤„ç†æ¸…ç®—æ•°æ®æ—¶å‡ºé”™:", e);
}
```

**æ—¥å¿—çº§åˆ«ä½¿ç”¨**ï¼š
- **INFO**ï¼šæ­£å¸¸ä¸šåŠ¡æµç¨‹è®°å½•
- **WARN**ï¼šæ½œåœ¨é—®é¢˜è­¦å‘Š
- **ERROR**ï¼šé”™è¯¯å¼‚å¸¸è®°å½•
- **DEBUG**ï¼šè¯¦ç»†è°ƒè¯•ä¿¡æ¯

### é˜¶æ®µå…­ï¼šæ‰©å±•åŠŸèƒ½å¼€å‘ (3-5å¤©)

#### 6.1 æ•°æ®æŒä¹…åŒ–æ‰©å±•

**ç›®æ ‡**ï¼šå°†Redisä¸­çš„ä¸´æ—¶æ•°æ®æŒä¹…åŒ–åˆ°MySQLæ•°æ®åº“ï¼Œåœ¨æ‰§è¡Œå®šæ—¶æ¸…ç†ä»»åŠ¡æ—¶åŒæ­¥ä¿å­˜å†å²æ•°æ®

**æ ¸å¿ƒé€»è¾‘**ï¼šåœ¨`cleanupExpiredData()`æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå°†å³å°†ä»Redisä¸­æ¸…ç†çš„è¿‡æœŸæ•°æ®å…ˆä¿å­˜åˆ°MySQLæ•°æ®åº“ï¼Œå®ç°æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨å’Œå†å²è¿½æº¯ã€‚

**å®ç°æ–¹æ¡ˆ**ï¼š
- è®¾è®¡MySQLè¡¨ç»“æ„å­˜å‚¨æ¸…ç®—å†å²æ•°æ®
- ä¿®æ”¹å®šæ—¶æ¸…ç†ä»»åŠ¡ï¼Œåœ¨åˆ é™¤Redisæ•°æ®å‰å…ˆä¿å­˜åˆ°MySQL
- å®ç°æ‰¹é‡æ’å…¥ä¼˜åŒ–æ€§èƒ½
- æ·»åŠ æ•°æ®å½’æ¡£å’Œå†å²æŸ¥è¯¢åŠŸèƒ½

**æ•°æ®åº“è®¾è®¡**ï¼š
```sql
-- æ¸…ç®—å†å²è®°å½•è¡¨
CREATE TABLE liquidation_history (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    symbol VARCHAR(20) NOT NULL COMMENT 'äº¤æ˜“å¯¹',
    side VARCHAR(10) NOT NULL COMMENT 'æ¸…ç®—æ–¹å‘ï¼šBUY/SELL',
    price DECIMAL(20,8) NOT NULL COMMENT 'æ¸…ç®—ä»·æ ¼',
    quantity DECIMAL(20,8) NOT NULL COMMENT 'æ¸…ç®—æ•°é‡',
    value DECIMAL(20,2) NOT NULL COMMENT 'æ¸…ç®—ä»·å€¼',
    liquidation_time TIMESTAMP NOT NULL COMMENT 'æ¸…ç®—æ—¶é—´',
    archived_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'å½’æ¡£æ—¶é—´',
    INDEX idx_symbol_time (symbol, liquidation_time),
    INDEX idx_archived_time (archived_time)
);

-- æ¸…ç®—ç»Ÿè®¡æ±‡æ€»è¡¨ï¼ˆå¯é€‰ï¼‰
CREATE TABLE liquidation_daily_stats (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    symbol VARCHAR(20) NOT NULL,
    stat_date DATE NOT NULL,
    long_count INT DEFAULT 0 COMMENT 'å¤šå•æ¸…ç®—æ¬¡æ•°',
    short_count INT DEFAULT 0 COMMENT 'ç©ºå•æ¸…ç®—æ¬¡æ•°',
    total_value DECIMAL(20,2) DEFAULT 0 COMMENT 'æ€»æ¸…ç®—ä»·å€¼',
    max_single_value DECIMAL(20,2) DEFAULT 0 COMMENT 'æœ€å¤§å•ç¬”æ¸…ç®—ä»·å€¼',
    avg_price DECIMAL(20,8) DEFAULT 0 COMMENT 'å¹³å‡æ¸…ç®—ä»·æ ¼',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_symbol_date (symbol, stat_date)
);
```

**æ ¸å¿ƒå®ç°é€»è¾‘**ï¼š

1. **ä¿®æ”¹LiquidationService.cleanupExpiredData()æ–¹æ³•**
```java
@Scheduled(fixedRate = 900000)
public void cleanupExpiredData() {
    log.info("å¼€å§‹æ‰§è¡Œæ¸…ç†è¿‡æœŸæ•°æ®ä»»åŠ¡");
    try {
        long currentTime = System.currentTimeMillis();
        long fifteenMinutesAgo = currentTime - 15 * 60 * 1000;
        
        // è·å–æ‰€æœ‰æ´»è·ƒäº¤æ˜“å¯¹
        List<String> activeSymbols = getActiveSymbols();
        List<String> symbolsToRemove = new ArrayList<>();
        
        // ç”¨äºæ‰¹é‡ä¿å­˜åˆ°MySQLçš„æ•°æ®åˆ—è¡¨
        List<LiquidationHistoryEntity> historyDataList = new ArrayList<>();
        
        for (String symbol : activeSymbols) {
            LiquidationData liquidationData = getLiquidationData(symbol);
            
            if (liquidationData != null) {
                // åˆ†ç¦»è¿‡æœŸå’Œæœ‰æ•ˆæ•°æ®
                List<LiquidationOrder> expiredOrders = new ArrayList<>();
                List<LiquidationOrder> validOrders = new ArrayList<>();
                
                for (LiquidationOrder order : liquidationData.getOrders()) {
                    if (order.getT() <= fifteenMinutesAgo) {
                        expiredOrders.add(order);  // è¿‡æœŸæ•°æ®
                    } else {
                        validOrders.add(order);    // æœ‰æ•ˆæ•°æ®
                    }
                }
                
                // å°†è¿‡æœŸæ•°æ®è½¬æ¢ä¸ºå†å²è®°å½•å®ä½“
                for (LiquidationOrder expiredOrder : expiredOrders) {
                    LiquidationHistoryEntity historyEntity = new LiquidationHistoryEntity();
                    historyEntity.setSymbol(symbol);
                    historyEntity.setSide(expiredOrder.getSide());
                    historyEntity.setPrice(new BigDecimal(expiredOrder.getP()));
                    historyEntity.setQuantity(new BigDecimal(expiredOrder.getQ()));
                    historyEntity.setValue(historyEntity.getPrice().multiply(historyEntity.getQuantity()));
                    historyEntity.setLiquidationTime(new Timestamp(expiredOrder.getT()));
                    historyEntity.setArchivedTime(new Timestamp(currentTime));
                    
                    historyDataList.add(historyEntity);
                }
                
                // æ›´æ–°Redisä¸­çš„æ•°æ®
                if (validOrders.isEmpty()) {
                    symbolsToRemove.add(symbol);
                    redisTemplate.delete("liquidation:" + symbol);
                } else {
                    liquidationData.setOrders(validOrders);
                    redisTemplate.opsForValue().set("liquidation:" + symbol, liquidationData);
                }
            }
        }
        
        // æ‰¹é‡ä¿å­˜å†å²æ•°æ®åˆ°MySQL
        if (!historyDataList.isEmpty()) {
            liquidationHistoryRepository.saveAll(historyDataList);
            log.info("æˆåŠŸä¿å­˜{}æ¡å†å²æ¸…ç®—è®°å½•åˆ°æ•°æ®åº“", historyDataList.size());
        }
        
        // æ›´æ–°æ´»è·ƒäº¤æ˜“å¯¹åˆ—è¡¨
        activeSymbols.removeAll(symbolsToRemove);
        redisTemplate.opsForValue().set("active_symbols", activeSymbols);
        
        log.info("æ¸…ç†ä»»åŠ¡å®Œæˆ - ç§»é™¤{}ä¸ªäº¤æ˜“å¯¹ï¼Œå½’æ¡£{}æ¡è®°å½•", 
                symbolsToRemove.size(), historyDataList.size());
                
    } catch (Exception e) {
        log.error("æ¸…ç†è¿‡æœŸæ•°æ®æ—¶å‡ºé”™:", e);
    }
}
```

2. **åˆ›å»ºå†å²æ•°æ®å®ä½“ç±»**
```java
@Entity
@Table(name = "liquidation_history")
public class LiquidationHistoryEntity {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "symbol", nullable = false, length = 20)
    private String symbol;
    
    @Column(name = "side", nullable = false, length = 10)
    private String side;
    
    @Column(name = "price", nullable = false, precision = 20, scale = 8)
    private BigDecimal price;
    
    @Column(name = "quantity", nullable = false, precision = 20, scale = 8)
    private BigDecimal quantity;
    
    @Column(name = "value", nullable = false, precision = 20, scale = 2)
    private BigDecimal value;
    
    @Column(name = "liquidation_time", nullable = false)
    private Timestamp liquidationTime;
    
    @Column(name = "archived_time")
    private Timestamp archivedTime;
    
    // getters and setters...
}
```

3. **åˆ›å»ºRepositoryæ¥å£**
```java
@Repository
public interface LiquidationHistoryRepository extends JpaRepository<LiquidationHistoryEntity, Long> {
    
    // æŒ‰äº¤æ˜“å¯¹å’Œæ—¶é—´èŒƒå›´æŸ¥è¯¢
    List<LiquidationHistoryEntity> findBySymbolAndLiquidationTimeBetween(
            String symbol, Timestamp startTime, Timestamp endTime);
    
    // æŒ‰æ—¶é—´èŒƒå›´ç»Ÿè®¡
    @Query("SELECT l.symbol, COUNT(l), SUM(l.value) FROM LiquidationHistoryEntity l " +
           "WHERE l.liquidationTime BETWEEN :startTime AND :endTime " +
           "GROUP BY l.symbol ORDER BY SUM(l.value) DESC")
    List<Object[]> getStatsByTimeRange(@Param("startTime") Timestamp startTime, 
                                      @Param("endTime") Timestamp endTime);
    
    // æ‰¹é‡æ’å…¥ä¼˜åŒ–
    @Modifying
    @Query(value = "INSERT INTO liquidation_history (symbol, side, price, quantity, value, liquidation_time, archived_time) " +
                   "VALUES (:#{#entity.symbol}, :#{#entity.side}, :#{#entity.price}, :#{#entity.quantity}, " +
                   ":#{#entity.value}, :#{#entity.liquidationTime}, :#{#entity.archivedTime})", 
           nativeQuery = true)
    void batchInsert(@Param("entity") LiquidationHistoryEntity entity);
}
```

4. **æ·»åŠ å†å²æ•°æ®æŸ¥è¯¢æœåŠ¡**
```java
@Service
public class LiquidationHistoryService {
    
    @Autowired
    private LiquidationHistoryRepository historyRepository;
    
    // æŸ¥è¯¢æŒ‡å®šäº¤æ˜“å¯¹çš„å†å²æ•°æ®
    public List<LiquidationHistoryEntity> getHistoryBySymbol(String symbol, 
                                                            LocalDateTime startTime, 
                                                            LocalDateTime endTime) {
        return historyRepository.findBySymbolAndLiquidationTimeBetween(
                symbol, 
                Timestamp.valueOf(startTime), 
                Timestamp.valueOf(endTime)
        );
    }
    
    // è·å–å†å²ç»Ÿè®¡æ•°æ®
    public Map<String, Object> getHistoryStats(LocalDateTime startTime, LocalDateTime endTime) {
        List<Object[]> results = historyRepository.getStatsByTimeRange(
                Timestamp.valueOf(startTime), 
                Timestamp.valueOf(endTime)
        );
        
        Map<String, Object> stats = new HashMap<>();
        for (Object[] result : results) {
            String symbol = (String) result[0];
            Long count = (Long) result[1];
            BigDecimal totalValue = (BigDecimal) result[2];
            
            Map<String, Object> symbolStats = new HashMap<>();
            symbolStats.put("count", count);
            symbolStats.put("totalValue", totalValue);
            stats.put(symbol, symbolStats);
        }
        
        return stats;
    }
}
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
- ä½¿ç”¨æ‰¹é‡æ’å…¥å‡å°‘æ•°æ®åº“è¿æ¥å¼€é”€
- æ·»åŠ é€‚å½“çš„æ•°æ®åº“ç´¢å¼•æé«˜æŸ¥è¯¢æ€§èƒ½
- è€ƒè™‘ä½¿ç”¨åˆ†åŒºè¡¨å¤„ç†å¤§é‡å†å²æ•°æ®
- å®ç°å®šæœŸæ•°æ®å½’æ¡£ï¼Œå°†è€æ—§æ•°æ®è¿ç§»åˆ°å½’æ¡£è¡¨

**æ‰©å±•åŠŸèƒ½**ï¼š
- æ·»åŠ å†å²æ•°æ®çš„REST APIæ¥å£
- å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV/Excelï¼‰
- æ·»åŠ å†å²æ•°æ®çš„å›¾è¡¨å¯è§†åŒ–
- å®ç°æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

#### 6.2 é«˜çº§ç»Ÿè®¡åŠŸèƒ½
**æŠ€æœ¯æŒ‡æ ‡è®¡ç®—**ï¼š
```java
// ç§»åŠ¨å¹³å‡çº¿è®¡ç®—
public double calculateMovingAverage(List<LiquidationOrder> orders, int period) {
    return orders.stream()
            .sorted(Comparator.comparing(LiquidationOrder::getT).reversed())
            .limit(period)
            .mapToDouble(order -> Double.parseDouble(order.getP()))
            .average()
            .orElse(0.0);
}

// æ³¢åŠ¨ç‡è®¡ç®—
public double calculateVolatility(List<LiquidationOrder> orders) {
    double mean = orders.stream()
            .mapToDouble(order -> Double.parseDouble(order.getP()))
            .average()
            .orElse(0.0);
    
    double variance = orders.stream()
            .mapToDouble(order -> {
                double price = Double.parseDouble(order.getP());
                return Math.pow(price - mean, 2);
            })
            .average()
            .orElse(0.0);
    
    return Math.sqrt(variance);
}
```

#### 6.3 å®æ—¶å‘Šè­¦ç³»ç»Ÿ
**å‘Šè­¦è§„åˆ™å¼•æ“**ï¼š
```java
@Component
public class AlertService {
    
    // å¤§é¢æ¸…ç®—å‘Šè­¦
    public void checkLargeOrderAlert(LiquidationOrder order) {
        double threshold = 1000000; // 100ä¸‡USDTé˜ˆå€¼
        if (order.getValue() > threshold) {
            sendAlert("å¤§é¢æ¸…ç®—å‘Šè­¦", 
                String.format("æ£€æµ‹åˆ°å¤§é¢æ¸…ç®—ï¼š%s %s %.2f USDT", 
                    order.getS(), order.getSide(), order.getValue()));
        }
    }
    
    // å¼‚å¸¸æ³¢åŠ¨å‘Šè­¦
    public void checkVolatilityAlert(String symbol, double amplitude) {
        double threshold = 5.0; // 5%æ³¢åŠ¨é˜ˆå€¼
        if (Math.abs(amplitude) > threshold) {
            sendAlert("ä»·æ ¼å¼‚å¸¸æ³¢åŠ¨", 
                String.format("%s ä»·æ ¼æ³¢åŠ¨è¶…è¿‡%.1f%%", symbol, amplitude));
        }
    }
}
```

## ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—

### ç¯å¢ƒå‡†å¤‡
1. **å®‰è£…JDK 17+**
   ```bash
   java -version  # æ£€æŸ¥ç‰ˆæœ¬
   ```

2. **å®‰è£…Redis**
   ```bash
   # Windows: ä¸‹è½½Rediså®‰è£…åŒ…
   # å¯åŠ¨RedisæœåŠ¡
   redis-server
   ```

3. **å®‰è£…Maven 3.6+**
   ```bash
   mvn -version  # æ£€æŸ¥ç‰ˆæœ¬
   ```

### è¿è¡Œé¡¹ç›®
1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <é¡¹ç›®åœ°å€>
   cd binance-spring
   ```

2. **å¯åŠ¨Redis**
   ```bash
   redis-server
   ```

3. **è¿è¡Œåº”ç”¨**
   ```bash
   mvn spring-boot:run
   ```

4. **è®¿é—®åº”ç”¨**
   - å®æ—¶æ•°æ®ï¼šhttp://localhost:3000/
   - 15åˆ†é’Ÿç»Ÿè®¡ï¼šhttp://localhost:3000/15min
   - å¸‚åœºæ•°æ®ï¼šhttp://localhost:3000/market

## ğŸ“– å­¦ä¹ è·¯å¾„å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼šç†è§£é¡¹ç›®æ¶æ„ï¼ˆ1-2å¤©ï¼‰
1. **ç†Ÿæ‚‰Spring BootåŸºç¡€**
   - äº†è§£è‡ªåŠ¨é…ç½®åŸç†
   - å­¦ä¹ ä¾èµ–æ³¨å…¥
   - æŒæ¡æ³¨è§£ä½¿ç”¨

2. **ç†è§£é¡¹ç›®ç»“æ„**
   - åˆ†æå„ä¸ªåŒ…çš„èŒè´£
   - ç†è§£MVCæ¶æ„
   - ç†Ÿæ‚‰é…ç½®æ–‡ä»¶

### ç¬¬äºŒé˜¶æ®µï¼šæ·±å…¥æ ¸å¿ƒåŠŸèƒ½ï¼ˆ2-3å¤©ï¼‰
1. **WebSocketå®æ—¶é€šä¿¡**
   ```java
   @Component
   public class WebSocketService {
       // å­¦ä¹ WebSocketçš„é…ç½®å’Œä½¿ç”¨
   }
   ```

2. **Redisæ•°æ®æ“ä½œ**
   ```java
   @Service
   public class LiquidationService {
       // å­¦ä¹ Redisçš„æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢
   }
   ```

3. **å‰ç«¯æ•°æ®å¯è§†åŒ–**
   ```javascript
   // å­¦ä¹ D3.jsçš„åŸºæœ¬ä½¿ç”¨
   d3.select("#chart")
     .selectAll("rect")
     .data(data)
     .enter()
     .append("rect");
   ```

### ç¬¬ä¸‰é˜¶æ®µï¼šåŠŸèƒ½æ‰©å±•ï¼ˆ2-3å¤©ï¼‰
1. **æ·»åŠ æ–°çš„ç»Ÿè®¡ç»´åº¦**
2. **ä¼˜åŒ–å‰ç«¯äº¤äº’ä½“éªŒ**
3. **å¢åŠ æ•°æ®å¯¼å‡ºåŠŸèƒ½**
4. **å®ç°ç”¨æˆ·åå¥½è®¾ç½®**

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### 1. Redisè¿æ¥å¤±è´¥
**é—®é¢˜**ï¼š`Connection refused: connect`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥Redisæ˜¯å¦å¯åŠ¨
redis-cli ping
# åº”è¯¥è¿”å› PONG

# å¦‚æœæ²¡æœ‰å¯åŠ¨ï¼Œæ‰§è¡Œï¼š
redis-server
```

### 2. ç«¯å£å ç”¨
**é—®é¢˜**ï¼š`Port 3000 was already in use`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```properties
# ä¿®æ”¹ application.properties
server.port=8080
```

### 3. WebSocketè¿æ¥å¤±è´¥
**é—®é¢˜**ï¼šå‰ç«¯æ— æ³•è¿æ¥WebSocket

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥WebSocketé…ç½®
2. ç¡®è®¤é˜²ç«å¢™è®¾ç½®
3. éªŒè¯URLè·¯å¾„æ­£ç¡®æ€§

## ğŸ“Š é¡¹ç›®äº®ç‚¹

### æŠ€æœ¯äº®ç‚¹
- ğŸ”„ **å®æ—¶æ•°æ®å¤„ç†**ï¼šä½¿ç”¨WebSocketå®ç°æ¯«ç§’çº§æ•°æ®æ›´æ–°
- ğŸš€ **é«˜æ€§èƒ½ç¼“å­˜**ï¼šRedisæä¾›å¿«é€Ÿæ•°æ®è®¿é—®
- ğŸ¨ **æ•°æ®å¯è§†åŒ–**ï¼šD3.jsåˆ›å»ºåŠ¨æ€å›¾è¡¨
- ğŸ“± **å“åº”å¼è®¾è®¡**ï¼šé€‚é…å¤šç§è®¾å¤‡

### ä¸šåŠ¡äº®ç‚¹
- ğŸ’¹ **é‡‘èæ•°æ®åˆ†æ**ï¼šå®æ—¶ç›‘æ§å¸‚åœºæ¸…ç®—æƒ…å†µ
- ğŸ“ˆ **ç»Ÿè®¡åˆ†æ**ï¼šå¤šç»´åº¦æ•°æ®ç»Ÿè®¡
- ğŸ” **æ•°æ®ç­›é€‰**ï¼šçµæ´»çš„è¿‡æ»¤åŠŸèƒ½
- âš¡ **å®æ—¶æ€§**ï¼šç§’çº§æ•°æ®æ›´æ–°

## ğŸ“ å­¦ä¹ æˆæœ

å®Œæˆè¿™ä¸ªé¡¹ç›®åï¼Œä½ å°†æŒæ¡ï¼š

### åç«¯æŠ€èƒ½
- âœ… Spring Bootåº”ç”¨å¼€å‘
- âœ… WebSocketå®æ—¶é€šä¿¡
- âœ… Redisæ•°æ®æ“ä½œ
- âœ… RESTful APIè®¾è®¡
- âœ… å®šæ—¶ä»»åŠ¡å¤„ç†

### å‰ç«¯æŠ€èƒ½
- âœ… åŸç”ŸJavaScriptå¼€å‘
- âœ… WebSocketå®¢æˆ·ç«¯ç¼–ç¨‹
- âœ… D3.jsæ•°æ®å¯è§†åŒ–
- âœ… å“åº”å¼Webè®¾è®¡
- âœ… å¼‚æ­¥ç¼–ç¨‹

### ç³»ç»Ÿè®¾è®¡
- âœ… å®æ—¶ç³»ç»Ÿæ¶æ„
- âœ… æ•°æ®æµè®¾è®¡
- âœ… ç¼“å­˜ç­–ç•¥
- âœ… æ€§èƒ½ä¼˜åŒ–

## ğŸ”® æ‰©å±•æ–¹å‘

### åŠŸèƒ½æ‰©å±•
1. **ç”¨æˆ·ç³»ç»Ÿ**ï¼šæ·»åŠ ç”¨æˆ·æ³¨å†Œã€ç™»å½•åŠŸèƒ½
2. **å‘Šè­¦ç³»ç»Ÿ**ï¼šå¤§é¢æ¸…ç®—è®¢å•å‘Šè­¦
3. **å†å²æ•°æ®**ï¼šé•¿æœŸæ•°æ®å­˜å‚¨å’Œåˆ†æ
4. **ç§»åŠ¨ç«¯**ï¼šå¼€å‘ç§»åŠ¨ç«¯åº”ç”¨

### æŠ€æœ¯å‡çº§
1. **å¾®æœåŠ¡æ¶æ„**ï¼šæ‹†åˆ†ä¸ºå¤šä¸ªæœåŠ¡
2. **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šä½¿ç”¨RabbitMQæˆ–Kafka
3. **å®¹å™¨åŒ–**ï¼šDockeréƒ¨ç½²
4. **ç›‘æ§ç³»ç»Ÿ**ï¼šæ·»åŠ ç³»ç»Ÿç›‘æ§

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [Spring Bootå®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [Rediså®˜æ–¹æ–‡æ¡£](https://redis.io/documentation)
- [D3.jså®˜æ–¹æ–‡æ¡£](https://d3js.org/)

### å­¦ä¹ èµ„æº
- [Spring Bootæ•™ç¨‹](https://www.baeldung.com/spring-boot)
- [WebSocketæ•™ç¨‹](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API)
- [Redisæ•™ç¨‹](https://redis.io/topics/data-types)

---

## ğŸ’¡ å°è´´å£«

> **ç»™åˆå­¦è€…çš„å»ºè®®**ï¼š
> 1. ğŸŒ **å¾ªåºæ¸è¿›**ï¼šä¸è¦æ€¥äºæ±‚æˆï¼Œä¸€æ­¥æ­¥ç†è§£æ¯ä¸ªæ¨¡å—
> 2. ğŸ” **å¤šçœ‹ä»£ç **ï¼šé˜…è¯»æºç æ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹å¼
> 3. ğŸ› ï¸ **åŠ¨æ‰‹å®è·µ**ï¼šç†è®ºç»“åˆå®è·µï¼Œå¤šå†™å¤šç»ƒ
> 4. ğŸ¤ **å¯»æ±‚å¸®åŠ©**ï¼šé‡åˆ°é—®é¢˜åŠæ—¶å¯»æ±‚å¸®åŠ©
> 5. ğŸ“ **è®°å½•æ€»ç»“**ï¼šå…»æˆè®°å½•å­¦ä¹ ç¬”è®°çš„ä¹ æƒ¯

**ç¥ä½ å­¦ä¹ æ„‰å¿«ï¼ğŸ‰**